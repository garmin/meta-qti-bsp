From 5090d9b3e0133d2cd5c29f6d432af3cc40b6a025 Mon Sep 17 00:00:00 2001
From: Lily Li <lali@codeaurora.org>
Date: Tue, 3 Sep 2019 16:53:50 +0800
Subject: [PATCH 07/42] gst-omx: change for height error of h265 dec

Change-Id: I77d40e726cdd55949d70e9c9ac8c4bdae2bbde8d
Signed-off-by: Lily Li <lali@codeaurora.org>
---
 omx/gstomx.c | 60 ++++++++++++++++++++++++++----------------------------------
 1 file changed, 26 insertions(+), 34 deletions(-)

diff --git a/omx/gstomx.c b/omx/gstomx.c
index 3282820..bf242bd 100644
--- a/omx/gstomx.c
+++ b/omx/gstomx.c
@@ -747,44 +747,36 @@ EventHandler (OMX_HANDLETYPE hComponent, OMX_PTR pAppData, OMX_EVENTTYPE eEvent,
     }
     case OMX_EventPortSettingsChanged:
     {
-      /* MSM8996: When receiving the OMX port setting change event with index
-       * "OMX_IndexConfigCommonOutputCrop" lets not invoke the omx port
-       * reconfiguration as port disable is not required for msm omx.
-       * FIXME: Update the renderer configuration. */
-      if (nData2 != OMX_IndexConfigCommonOutputCrop)
-      {
-        GstOMXMessage *msg = g_slice_new (GstOMXMessage);
-        OMX_U32 index;
+      GstOMXMessage *msg = g_slice_new (GstOMXMessage);
+      OMX_U32 index;
 
-        if (!(comp->hacks &
-                GST_OMX_HACK_EVENT_PORT_SETTINGS_CHANGED_NDATA_PARAMETER_SWAP)) {
-          index = nData1;
-        } else {
-          index = nData2;
-        }
+      if (!(comp->hacks &
+              GST_OMX_HACK_EVENT_PORT_SETTINGS_CHANGED_NDATA_PARAMETER_SWAP)) {
+        index = nData1;
+      } else {
+        index = nData2;
+      }
 
+      if (index == 0
+          && (comp->hacks &
+              GST_OMX_HACK_EVENT_PORT_SETTINGS_CHANGED_PORT_0_TO_1))
+        index = 1;
 
-        if (index == 0
-            && (comp->hacks &
-                GST_OMX_HACK_EVENT_PORT_SETTINGS_CHANGED_PORT_0_TO_1))
-          index = 1;
-
-        if (nData2 == OMX_IndexParamPortDefinition)
-		{
-          msg->type = GST_OMX_MESSAGE_PORT_SETTINGS_CHANGED;
-          msg->content.port_settings_changed.port = index;
-          GST_DEBUG_OBJECT (comp->parent, "%s settings changed (port index: %u)",
-            comp->name, (guint) msg->content.port_settings_changed.port);
-		}
-        else if (nData2 == OMX_IndexConfigCommonOutputCrop){
-          msg->type = GST_OMX_MESSAGE_PORT_RECT_CHANGED;
-          msg->content.port_settings_changed.port = index;
-          GST_DEBUG_OBJECT (comp->parent, "%s rectangle changed (port index: %u)",
-            comp->name, (guint) msg->content.port_settings_changed.port);
-        }
-
-        gst_omx_component_send_message (comp, msg);
+      if (nData2 == OMX_IndexParamPortDefinition)
+      {
+        msg->type = GST_OMX_MESSAGE_PORT_SETTINGS_CHANGED;
+        msg->content.port_settings_changed.port = index;
+        GST_DEBUG_OBJECT (comp->parent, "%s settings changed (port index: %u)",
+          comp->name, (guint) msg->content.port_settings_changed.port);
+      }
+      else if (nData2 == OMX_IndexConfigCommonOutputCrop){
+        msg->type = GST_OMX_MESSAGE_PORT_RECT_CHANGED;
+        msg->content.port_settings_changed.port = index;
+        GST_DEBUG_OBJECT (comp->parent, "%s rectangle changed (port index: %u)",
+          comp->name, (guint) msg->content.port_settings_changed.port);
       }
+
+      gst_omx_component_send_message (comp, msg);
       break;
     }
     case OMX_EventBufferFlag:{
-- 
2.7.4

